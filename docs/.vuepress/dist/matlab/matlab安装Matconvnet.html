<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>matlab安装Matconvnet | 上学时笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/school-note/images/myfavicon.png">
    <meta name="description" content="怀念象牙塔时光">
    
    <link rel="preload" href="/school-note/assets/css/0.styles.c30ed50d.css" as="style"><link rel="preload" href="/school-note/assets/js/app.6d0a310f.js" as="script"><link rel="preload" href="/school-note/assets/js/2.26c8f057.js" as="script"><link rel="preload" href="/school-note/assets/js/1.9edbc7d9.js" as="script"><link rel="preload" href="/school-note/assets/js/37.6f65e785.js" as="script"><link rel="prefetch" href="/school-note/assets/js/10.c468120d.js"><link rel="prefetch" href="/school-note/assets/js/11.e082b28d.js"><link rel="prefetch" href="/school-note/assets/js/12.b3f55500.js"><link rel="prefetch" href="/school-note/assets/js/13.3cf53809.js"><link rel="prefetch" href="/school-note/assets/js/14.d3d0eed0.js"><link rel="prefetch" href="/school-note/assets/js/15.bce5077a.js"><link rel="prefetch" href="/school-note/assets/js/16.de32fbbc.js"><link rel="prefetch" href="/school-note/assets/js/17.a3171d8a.js"><link rel="prefetch" href="/school-note/assets/js/18.b6751064.js"><link rel="prefetch" href="/school-note/assets/js/19.354d5fb8.js"><link rel="prefetch" href="/school-note/assets/js/20.3b4e6714.js"><link rel="prefetch" href="/school-note/assets/js/21.1744c71c.js"><link rel="prefetch" href="/school-note/assets/js/22.9aa39c11.js"><link rel="prefetch" href="/school-note/assets/js/23.8206a1a1.js"><link rel="prefetch" href="/school-note/assets/js/24.77c390b0.js"><link rel="prefetch" href="/school-note/assets/js/25.770806bd.js"><link rel="prefetch" href="/school-note/assets/js/26.d1e01b93.js"><link rel="prefetch" href="/school-note/assets/js/27.903242ff.js"><link rel="prefetch" href="/school-note/assets/js/28.c2317508.js"><link rel="prefetch" href="/school-note/assets/js/29.26272083.js"><link rel="prefetch" href="/school-note/assets/js/3.fd9cce16.js"><link rel="prefetch" href="/school-note/assets/js/30.af6d03e5.js"><link rel="prefetch" href="/school-note/assets/js/31.bb5e7344.js"><link rel="prefetch" href="/school-note/assets/js/32.51b20337.js"><link rel="prefetch" href="/school-note/assets/js/33.083fc63c.js"><link rel="prefetch" href="/school-note/assets/js/34.dad7dccc.js"><link rel="prefetch" href="/school-note/assets/js/35.85a57d54.js"><link rel="prefetch" href="/school-note/assets/js/36.7378acee.js"><link rel="prefetch" href="/school-note/assets/js/38.6903a37f.js"><link rel="prefetch" href="/school-note/assets/js/39.a81d4292.js"><link rel="prefetch" href="/school-note/assets/js/4.0aa80050.js"><link rel="prefetch" href="/school-note/assets/js/40.856998f7.js"><link rel="prefetch" href="/school-note/assets/js/41.fbd5d9bd.js"><link rel="prefetch" href="/school-note/assets/js/42.0ddb0c14.js"><link rel="prefetch" href="/school-note/assets/js/43.08188f4a.js"><link rel="prefetch" href="/school-note/assets/js/44.19b3cec8.js"><link rel="prefetch" href="/school-note/assets/js/45.ff9516d6.js"><link rel="prefetch" href="/school-note/assets/js/46.7f0a5a03.js"><link rel="prefetch" href="/school-note/assets/js/47.d79a3cd6.js"><link rel="prefetch" href="/school-note/assets/js/48.b4661dad.js"><link rel="prefetch" href="/school-note/assets/js/49.70afd433.js"><link rel="prefetch" href="/school-note/assets/js/5.d1a412fe.js"><link rel="prefetch" href="/school-note/assets/js/6.bb714e54.js"><link rel="prefetch" href="/school-note/assets/js/7.10f49e1d.js"><link rel="prefetch" href="/school-note/assets/js/vendors~docsearch.06a8db8f.js">
    <link rel="stylesheet" href="/school-note/assets/css/0.styles.c30ed50d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/school-note/" class="home-link router-link-active"><!----> <span class="site-name">上学时笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>matlab</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/school-note/matlab/常用函数.html" class="sidebar-link">常用函数</a></li><li><a href="/school-note/matlab/语法.html" class="sidebar-link">语法</a></li><li><a href="/school-note/matlab/matlab安装Matconvnet.html" class="active sidebar-link">matlab安装Matconvnet</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>无人机项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数字图像处理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深度学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>信源数估计</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="matlab安装matconvnet"><a href="#matlab安装matconvnet" class="header-anchor">#</a> matlab安装Matconvnet</h2> <h3 id="安装步骤"><a href="#安装步骤" class="header-anchor">#</a> 安装步骤</h3> <p><code>前提：已经安装好 CUDA 和 CUDNN ，最好先安装 Visual Studio 再安装 matlab ，否则在 matlab 里 mex -setup 命令关联不到 VS 的 c++ 编译器，并且 VS 要自定义安装，选择 c++ 。</code></p> <p>1、首先，在<a href="https://www.vlfeat.org/matconvnet/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上下载matconvnet压缩包。</p> <p>2、安装 matlab 支持的编译器 MinGW，在<a href="https://ww2.mathworks.cn/matlabcentral/fileexchange/52848-matlab-support-for-mingw-w64-c-c-compiler" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上下载，之后将下载好的文件放在 matlab 的 bin 文件夹中，打开 matlab ，将当前目录切换到 bin 中，打开下载好的文件，根据步骤进行安装。</p> <p>3、若没有 Visual Studio，则需要下载 Visual Studio ，之后在 matlab 命令窗口依次输入以下命令：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> cd <span class="token operator">&lt;</span>MatConvNet<span class="token operator">&gt;</span><span class="token punctuation">;</span>   <span class="token comment">% 将路径切换到matconvnet文件夹下</span>
<span class="token operator">&gt;</span><span class="token operator">&gt;</span> addpath matlab<span class="token punctuation">;</span>
<span class="token operator">&gt;</span><span class="token operator">&gt;</span> vl_compilenn<span class="token punctuation">;</span>
<span class="token operator">&gt;</span><span class="token operator">&gt;</span> vl_testnn<span class="token punctuation">;</span>
</code></pre></div><p>以上是使用CPU的情况，使用GPU的编译流程如下：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">vl_compilenn</span><span class="token punctuation">(</span><span class="token string">'enableGpu'</span><span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>或者：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">vl_compilenn</span><span class="token punctuation">(</span><span class="token string">'enableGpu'</span><span class="token punctuation">,</span> true<span class="token punctuation">,</span> <span class="token punctuation">...</span>
               <span class="token string">'cudaRoot'</span><span class="token punctuation">,</span> <span class="token string">'/Developer/NVIDIA/CUDA-7.5'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>    <span class="token comment">%这里是CUDA的安装地址，一般是在C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.0这里。</span>
               <span class="token string">'cudaMethod'</span><span class="token punctuation">,</span> <span class="token string">'nvcc'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
               <span class="token string">'enableCudnn'</span><span class="token punctuation">,</span> true<span class="token punctuation">,</span> <span class="token punctuation">...</span>
               <span class="token string">'cudnnRoot'</span><span class="token punctuation">,</span> <span class="token string">'local/cudnn-rc4'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>                <span class="token comment">%这里是CUDNN的安装地址，依据个人情况的不同。</span>
</code></pre></div><p>编译成功后使用以下命令：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">vl_testnn</span><span class="token punctuation">(</span><span class="token string">'gpu'</span><span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">% 这条命令编译需要很长时间</span>
</code></pre></div><p>注意：<br>
1）Matconvnet 只需要配置一次，不同的算法，直接把配置好的 Matconvnet，路径下的 <code>MATLAB/mex</code> 的文件拷贝到需要运行的算法对应位置处即可，不需要每次都配置。<br>
2）Matlconvnet 可以编译成功，但是每次开 matlab 都需要编译一次？不需要，关闭 matlab 重新打开后，先运行 gpuDevice 然后就可以正常使用了 Matconvnet 了。</p> <h3 id="出现的问题及解决方案"><a href="#出现的问题及解决方案" class="header-anchor">#</a> 出现的问题及解决方案</h3> <p>1、在输入<code>vl_compilenn</code>这步可能会出现如下问题：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>警告<span class="token operator">:</span> CL<span class="token punctuation">.</span>EXE not found in PATH<span class="token punctuation">.</span> Trying to guess out of mex setup<span class="token punctuation">.</span> 
<span class="token operator">&gt;</span> In vl_compilenn<span class="token operator">&gt;</span><span class="token function">check_clpath</span> <span class="token punctuation">(</span>line <span class="token number">650</span><span class="token punctuation">)</span>
  In <span class="token function">vl_compilenn</span> <span class="token punctuation">(</span>line <span class="token number">426</span><span class="token punctuation">)</span> 
<span class="token string">'cl.exe'</span> 不是内部或外部命令，也不是可运行的程序 
或批处理文件。 
错误使用 vl_compilenn<span class="token operator">&gt;</span><span class="token function">check_clpath</span> <span class="token punctuation">(</span>line <span class="token number">656</span><span class="token punctuation">)</span>
Unable to find cl<span class="token punctuation">.</span>exe

出错 <span class="token function">vl_compilenn</span> <span class="token punctuation">(</span>line <span class="token number">426</span><span class="token punctuation">)</span>
    cl_path <span class="token operator">=</span> <span class="token function">fileparts</span><span class="token punctuation">(</span><span class="token function">check_clpath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% check whether cl.exe in path</span>
</code></pre></div><p>解决方案：这是因为系统没找到 cl.exe 文件，这个文件在 Visual Studio 中的，一般在<code>E:\Program Files (x86)\Microsoft Visual Studio\VC\Tools\MSVC\14.16.27023\bin\Hostx86\x86</code>中。注意，在下载安装VS时要把编译器的那些选项选上，才能找到 VC 文件夹。找到 cl.exe 文件，然后将其将其路径添加到环境变量中即可。具体添加过程如下：<br>
1）打开此电脑，右键点击属性，然后点击左侧的高级系统设置，再点击环境变量，我们这里在用户变量中添加即可。<br>
2）找到 Path，双击然后在末尾添加你电脑中 cl.exe 对应的路径。到这里测试一下，按 Windows + R 的组合键，然后输入 cmd 命令，打开控制台，输入 cl 。</p> <p>2、在输入<code>vl_compilenn</code>这步可能会出现如下问题：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>出错 vl_compilenn<span class="token operator">&gt;</span><span class="token function">mex_link</span> <span class="token punctuation">(</span>line <span class="token number">627</span><span class="token punctuation">)</span>
<span class="token function">mex</span><span class="token punctuation">(</span>args<span class="token punctuation">{</span><span class="token operator">:</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
出错 <span class="token function">vl_compilenn</span> <span class="token punctuation">(</span>line <span class="token number">500</span><span class="token punctuation">)</span>
<span class="token function">mex_link</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> objs<span class="token punctuation">,</span> flags<span class="token punctuation">.</span>mex_dir<span class="token punctuation">,</span> flags<span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>解决方案：这是因为 matlab 不支持 Mingw 编译器（虽然 matlab 很推荐），要使用 Visual Studio 的 C++ 编译器，先在 matlab 命令窗口输入<code>mex -setup -v</code>命令，查看可以使用的编译器，若有 Visual Studio 编译器则使用，若没有 Visual Studio 编译器，可能是因为注册表中没有 Microsoft SDK 这个注册表项，需要在 Visual Studio 安装界面（不管有没有安装好），在组件中找到 Visual Studio SDK 和 Windows 10 SDK 选上，安装或修改。之后重新打开 matlab ，重新输入命令 <code>vl_compilenn</code> ，则可以正确编译。</p> <p>3、在<code>vl_compilenn('enableGpu', true)</code>时可能会出现如下错误：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>Error using vl_compilenn<span class="token operator">&gt;</span><span class="token function">nvcc_compile</span> <span class="token punctuation">(</span>line <span class="token number">615</span><span class="token punctuation">)</span>
Command &quot;C<span class="token operator">:</span><span class="token operator">\</span>Program Files<span class="token operator">\</span>NVIDIA GPU Computing Toolkit<span class="token operator">\</span>CUDA<span class="token operator">\</span>v9<span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">\</span>bin<span class="token operator">\</span>nvcc&quot; <span class="token operator">-</span>c <span class="token operator">-</span>o
&quot;D<span class="token operator">:</span><span class="token operator">\</span>Matlab<span class="token operator">\</span>matconvnet<span class="token operator">-</span><span class="token number">1.0</span><span class="token operator">-</span>beta25<span class="token operator">\</span>matconvnet<span class="token operator">-</span><span class="token number">1.0</span><span class="token operator">-</span>beta25<span class="token operator">\</span>matlab<span class="token operator">\</span>mex<span class="token operator">\</span><span class="token punctuation">.</span>build<span class="token operator">\</span>bits<span class="token operator">\</span>data<span class="token punctuation">.</span>obj&quot;
&quot;D<span class="token operator">:</span><span class="token operator">\</span>Matlab<span class="token operator">\</span>matconvnet<span class="token operator">-</span><span class="token number">1.0</span><span class="token operator">-</span>beta25<span class="token operator">\</span>matconvnet<span class="token operator">-</span><span class="token number">1.0</span><span class="token operator">-</span>beta25<span class="token operator">\</span>matlab<span class="token operator">\</span>src<span class="token operator">\</span>bits<span class="token operator">\</span>data<span class="token punctuation">.</span>cu&quot; <span class="token operator">-</span>DENABLE_GPU <span class="token operator">-</span>DENABLE_DOUBLE
<span class="token operator">-</span>DENABLE_CUDNN <span class="token operator">-</span>I&quot;<span class="token punctuation">.</span>local<span class="token operator">\</span>cudnn<span class="token operator">\</span>include&quot; <span class="token operator">-</span>O <span class="token operator">-</span>DNDEBUG <span class="token operator">-</span>D_FORCE_INLINES <span class="token operator">-</span><span class="token operator">-</span>std<span class="token operator">=</span>c<span class="token operator">+</span><span class="token operator">+</span><span class="token number">11</span>
<span class="token operator">-</span>I&quot;D<span class="token operator">:</span><span class="token operator">\</span>Matlab<span class="token operator">\</span>extern<span class="token operator">\</span>include&quot; <span class="token operator">-</span>I&quot;D<span class="token operator">:</span><span class="token operator">\</span>Matlab<span class="token operator">\</span>toolbox<span class="token operator">\</span>distcomp<span class="token operator">\</span>gpu<span class="token operator">\</span>extern<span class="token operator">\</span>include&quot;
<span class="token operator">-</span>gencode<span class="token operator">=</span>arch<span class="token operator">=</span>compute_52<span class="token punctuation">,</span>code<span class="token operator">=</span><span class="token operator">\</span>&quot;sm_52<span class="token punctuation">,</span>compute_52<span class="token operator">\</span>&quot;  <span class="token operator">-</span><span class="token operator">-</span>compiler<span class="token operator">-</span>options<span class="token operator">=</span><span class="token operator">/</span>MD <span class="token operator">-</span><span class="token operator">-</span>compiler<span class="token operator">-</span>bindir<span class="token operator">=</span>&quot;C<span class="token operator">:</span><span class="token operator">\</span>Program
<span class="token function">Files</span> <span class="token punctuation">(</span>x86<span class="token punctuation">)</span><span class="token operator">\</span>Microsoft Visual Studio<span class="token operator">\</span><span class="token number">2017</span><span class="token operator">\</span>Community<span class="token operator">\</span>VC<span class="token operator">\</span>bin&quot;  failed<span class="token punctuation">.</span>

Error in <span class="token function">vl_compilenn</span> <span class="token punctuation">(</span>line <span class="token number">487</span><span class="token punctuation">)</span>
      <span class="token function">nvcc_compile</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> srcs<span class="token punctuation">{</span><span class="token number">i</span><span class="token punctuation">}</span><span class="token punctuation">,</span> objfile<span class="token punctuation">,</span> flags<span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>解决方案：（以下几个步骤可能都需要用到，不确定哪个是对的）<br>
1）在 <code>C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC</code> 下创建 bin 文件夹。<br>
2）在 matconvnet-1.0-beta25（建议重命名文件夹改为 matconvnet）中建一个 local 文件夹（与 example 和 matlab 等同一“级别”），然后把下载的 cudnn 放进去。<br>
3）更改 matlab 配置 GPU 的配置文件，其路径是 <code>D:\Softwares\MATLAB\toolbox\distcomp\gpu\extern\src\mex\win64</code> ，在其中有多个文件如 <code>nvcc_msvcpp2015_dynamic.xml ,nvcc_msvcpp2015.xml</code>等文件，打开这些文件，注意，这里需要更改的配置文件与使用编译的 Visual Studio 版本有关，本人 VS 版本是2017，所以更改 <code>nvcc_msvcpp2017.xml</code>和<code>nvcc_msvcpp2017_dynamic.xml</code>即可，为保险起见，将这些文件全部修改。具体修改是将文件中CUDA版本如<code>8.0</code>改为自己所安装的 CUDA 版本<code>11.0</code>，注意是全部替换掉。<br>
4）打开<code>vl_compilenn.m</code>，更改687行，原先是：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token keyword">for</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'5.5'</span><span class="token punctuation">,</span> <span class="token string">'6.0'</span><span class="token punctuation">,</span> <span class="token string">'6.5'</span><span class="token punctuation">,</span> <span class="token string">'7.0'</span><span class="token punctuation">,</span> <span class="token string">'7.5'</span><span class="token punctuation">,</span> <span class="token string">'8.0'</span><span class="token punctuation">,</span> <span class="token string">'8.5'</span><span class="token punctuation">,</span> <span class="token string">'9.0'</span><span class="token punctuation">,</span> <span class="token string">'9.5'</span><span class="token punctuation">,</span> <span class="token string">'10.0'</span><span class="token punctuation">}</span>；
</code></pre></div><p>将其改为：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token keyword">for</span> v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'5.5'</span><span class="token punctuation">,</span> <span class="token string">'6.0'</span><span class="token punctuation">,</span> <span class="token string">'6.5'</span><span class="token punctuation">,</span> <span class="token string">'7.0'</span><span class="token punctuation">,</span> <span class="token string">'7.5'</span><span class="token punctuation">,</span> <span class="token string">'8.0'</span><span class="token punctuation">,</span> <span class="token string">'8.5'</span><span class="token punctuation">,</span> <span class="token string">'9.0'</span><span class="token punctuation">,</span> <span class="token string">'9.5'</span><span class="token punctuation">,</span> <span class="token string">'10.0'</span><span class="token punctuation">,</span> <span class="token string">'11.0'</span><span class="token punctuation">}</span>  <span class="token comment">%这里最后新添加的‘11.0’是指自己的CUDA版本；</span>
</code></pre></div><br> <p>4、在<code>vl_compilenn('enableGpu', true)</code>时可能会出现如下错误：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code>nvcc fatal   <span class="token operator">:</span> <span class="token string">'-DNDEBUG'</span><span class="token operator">:</span> expected a number 
错误使用 vl_compilenn<span class="token operator">&gt;</span><span class="token function">nvcc_compile</span> <span class="token punctuation">(</span>line <span class="token number">615</span><span class="token punctuation">)</span>
Command &quot;C<span class="token operator">:</span><span class="token operator">\</span>Program Files<span class="token operator">\</span>NVIDIA GPU Computing Toolkit<span class="token operator">\</span>CUDA<span class="token operator">\</span>v10<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">\</span>bin<span class="token operator">\</span>nvcc&quot; <span class="token operator">-</span>c <span class="token operator">-</span>o
&quot;E<span class="token operator">:</span><span class="token operator">\</span>matconvnet<span class="token operator">\</span>matlab<span class="token operator">\</span>mex<span class="token operator">\</span><span class="token punctuation">.</span>build<span class="token operator">\</span>bits<span class="token operator">\</span>data<span class="token punctuation">.</span>obj&quot;
&quot;E<span class="token operator">:</span><span class="token operator">\</span>matconvnet<span class="token operator">\</span>matlab<span class="token operator">\</span>src<span class="token operator">\</span>bits<span class="token operator">\</span>data<span class="token punctuation">.</span>cu&quot; <span class="token operator">-</span>DENABLE_GPU
<span class="token operator">-</span>DENABLE_DOUBLE <span class="token operator">-</span>O <span class="token operator">-</span>DNDEBUG <span class="token operator">-</span>D_FORCE_INLINES <span class="token operator">-</span><span class="token operator">-</span>std<span class="token operator">=</span>c<span class="token operator">+</span><span class="token operator">+</span><span class="token number">11</span> <span class="token operator">-</span>I&quot;D<span class="token operator">:</span><span class="token operator">\</span>Softwares<span class="token operator">\</span>MATLAB<span class="token operator">\</span>extern<span class="token operator">\</span>include&quot;
<span class="token operator">-</span>I&quot;D<span class="token operator">:</span><span class="token operator">\</span>Softwares<span class="token operator">\</span>MATLAB<span class="token operator">\</span>toolbox<span class="token operator">\</span>distcomp<span class="token operator">\</span>gpu<span class="token operator">\</span>extern<span class="token operator">\</span>include&quot; <span class="token operator">-</span>gencode<span class="token operator">=</span>arch<span class="token operator">=</span>compute_75<span class="token punctuation">,</span>code<span class="token operator">=</span><span class="token operator">\</span>&quot;sm_75<span class="token punctuation">,</span>compute_75<span class="token operator">\</span>&quot;  <span class="token operator">-</span><span class="token operator">-</span>compiler<span class="token operator">-</span>options<span class="token operator">=</span><span class="token operator">/</span>MD
<span class="token operator">-</span><span class="token operator">-</span>compiler<span class="token operator">-</span>bindir<span class="token operator">=</span>&quot;D<span class="token operator">:</span><span class="token operator">\</span>Softwares<span class="token operator">\</span>VisualStudio<span class="token operator">\</span>VC<span class="token operator">\</span>Tools<span class="token operator">\</span>MSVC<span class="token operator">\</span><span class="token number">14.16</span><span class="token number">.27023</span><span class="token operator">\</span>bin<span class="token operator">\</span>Hostx64&quot;  failed<span class="token punctuation">.</span>

出错 <span class="token function">vl_compilenn</span> <span class="token punctuation">(</span>line <span class="token number">487</span><span class="token punctuation">)</span>
      <span class="token function">nvcc_compile</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> srcs<span class="token punctuation">{</span><span class="token number">i</span><span class="token punctuation">}</span><span class="token punctuation">,</span> objfile<span class="token punctuation">,</span> flags<span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>出现原因：CUDA 10.1 以前的版本使用非 debug 模式下 GPU 优化指令是<code>-O</code>，CUDA 10.1以上版本把<code>-O</code>指令给弃用了。现在的指令为<code>-O+</code>数字，此处的数字为优化的等级。<code>vl_compilenn</code>默认编译是非 debug 模式的，所以 matlab 会提示我们需要一个数字。<br>
解决方案：将<code>vl_compilenn.m</code>，将606行的<code>nvcc_compile</code>函数进行更改。原先的函数为：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">nvcc_compile</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> src<span class="token punctuation">,</span> tgt<span class="token punctuation">,</span> flags<span class="token punctuation">)</span>
<span class="token comment">% --------------------------------------------------------------------</span>
<span class="token keyword">if</span> <span class="token function">check_deps</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> tgt<span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">return</span> <span class="token punctuation">;</span> <span class="token keyword">end</span>
nvcc_path <span class="token operator">=</span> <span class="token function">fullfile</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>cudaRoot<span class="token punctuation">,</span> <span class="token string">'bin'</span><span class="token punctuation">,</span> <span class="token string">'nvcc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
nvcc_cmd <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string">'&quot;%s&quot; -c -o &quot;%s&quot; &quot;%s&quot; %s '</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
                   nvcc_path<span class="token punctuation">,</span> tgt<span class="token punctuation">,</span> src<span class="token punctuation">,</span> <span class="token punctuation">...</span>
                   <span class="token function">strjoin</span><span class="token punctuation">(</span><span class="token function">horzcat</span><span class="token punctuation">(</span>flags<span class="token punctuation">.</span>base<span class="token punctuation">,</span>flags<span class="token punctuation">.</span>nvcc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
opts<span class="token punctuation">.</span>verbose <span class="token operator">&amp;&amp;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token string">'%s: NVCC CC: %s\n'</span><span class="token punctuation">,</span> mfilename<span class="token punctuation">,</span> nvcc_cmd<span class="token punctuation">)</span> <span class="token punctuation">;</span>
status <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span>nvcc_cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> status<span class="token punctuation">,</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Command %s failed.'</span><span class="token punctuation">,</span> nvcc_cmd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div><p>更改后的函数为：</p> <div class="language-matlab extra-class"><pre class="language-matlab"><code><span class="token keyword">function</span> <span class="token function">nvcc_compile</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> src<span class="token punctuation">,</span> tgt<span class="token punctuation">,</span> flags<span class="token punctuation">)</span>
<span class="token comment">% --------------------------------------------------------------------</span>
mybase<span class="token operator">=</span>flags<span class="token punctuation">.</span>base<span class="token punctuation">;</span>
<span class="token function">mybase</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'-O3'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token function">check_deps</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> tgt<span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">return</span> <span class="token punctuation">;</span> <span class="token keyword">end</span>
nvcc_path <span class="token operator">=</span> <span class="token function">fullfile</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>cudaRoot<span class="token punctuation">,</span> <span class="token string">'bin'</span><span class="token punctuation">,</span> <span class="token string">'nvcc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
nvcc_cmd <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string">'&quot;%s&quot; -c -o &quot;%s&quot; &quot;%s&quot; %s '</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
                   nvcc_path<span class="token punctuation">,</span> tgt<span class="token punctuation">,</span> src<span class="token punctuation">,</span> <span class="token punctuation">...</span>
                   <span class="token function">strjoin</span><span class="token punctuation">(</span><span class="token function">horzcat</span><span class="token punctuation">(</span>mybase<span class="token punctuation">,</span>flags<span class="token punctuation">.</span>nvcc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
opts<span class="token punctuation">.</span>verbose <span class="token operator">&amp;&amp;</span> <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token string">'%s: NVCC CC: %s\n'</span><span class="token punctuation">,</span> mfilename<span class="token punctuation">,</span> nvcc_cmd<span class="token punctuation">)</span> <span class="token punctuation">;</span>
status <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span>nvcc_cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> status<span class="token punctuation">,</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Command %s failed.'</span><span class="token punctuation">,</span> nvcc_cmd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/school-note/matlab/语法.html" class="prev">
        语法
      </a></span> <span class="next"><a href="/school-note/python/pycharm出现的问题及解决方法.html">
        pycharm项目中出现的问题及解决方法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/school-note/assets/js/app.6d0a310f.js" defer></script><script src="/school-note/assets/js/2.26c8f057.js" defer></script><script src="/school-note/assets/js/1.9edbc7d9.js" defer></script><script src="/school-note/assets/js/37.6f65e785.js" defer></script>
  </body>
</html>
